<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiline Chart</title>
  <style>
    .line {
      fill: none;
      stroke-width: 2px;
    }
  </style>
</head>
<body>
  
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Set margins and dimensions
    const margin = { top: 50, right: 200, bottom: 40, left: 80 };
    const width = 900 - margin.left - margin.right;
    const height = 250 - margin.top - margin.bottom;
    
    const svg = d3.select("body").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
      .append("g")
      .attr("transform", `translate(${margin.left}, ${margin.top})`);
    
    d3.csv("scripts/data_sample_modified.csv").then(function(data) {
      data.forEach(function(d) {
        d.date = d3.timeParse("%m/%d/%y")(d.date);  
        d.EstimatedCost = +d.EstimatedCost;
        d.ActualCost = +d.ActualCost;
        d.SoldPrice = +d.SoldPrice;
        d.MarginOfProfit = +d.MarginOfProfit;  
      });
    
      // Define X and Y scales
      const x = d3.scaleTime()
        .domain(d3.extent(data, d => d.date))  
        .range([0, width]);
    
      const y = d3.scaleLinear()
        .domain([d3.min(data, d => Math.min(d.EstimatedCost, d.ActualCost, d.SoldPrice, d.MarginOfProfit))-100, d3.max(data, d => Math.max(d.EstimatedCost, d.ActualCost, d.SoldPrice, d.MarginOfProfit))])  
        .range([height, -10]);
    
      // Append the X-axis
      svg.append("g")
        .attr("transform", `translate(0, ${height})`)
        .call(d3.axisBottom(x));
    
      // Append the Y-axis
      svg.append("g")
        .call(d3.axisLeft(y));
    
      // Line generator function
      const line = d3.line()
        .x(d => x(d.date))  
        .y(d => y(d.value));  
    
      const color = d3.scaleOrdinal(d3.schemeCategory10);
    
      // Data series to plot
      const series = [
        { name: "Estimated Cost", key: "EstimatedCost" },
        { name: "Actual Cost", key: "ActualCost" },
        { name: "Sold Price", key: "SoldPrice" },
        { name: "Margin Of Profit", key: "MarginOfProfit" }
      ];
     
      // Draw a line for each series
      series.forEach((s, i) => {
        svg.append("path")
          .datum(data.map(d => ({ date: d.date, value: d[s.key] })))
          .attr("class", "line")
          .attr("d", line)
          .attr("stroke", color(i)) 
          .attr("stroke-width", 2)
          .attr("fill", "none");
      });
    
      // Add transitions to lines
      svg.selectAll(".line")
        .transition()
        .duration(2000)
        .attr("stroke-width", 3);
    
      // Add legend
      const legend = svg.append("g")
        .attr("class", "legend")
        .attr("transform", `translate(${width + 20}, 10)`); // Adjust legend position

      series.forEach((s, i) => {
        const legendItem = legend.append("g")
          .attr("transform", `translate(0, ${i * 20})`);  // Adjust vertical spacing

        // Add colored box
        legendItem.append("rect")
          .attr("x", 0)
          .attr("y", 0)
          .attr("width", 10)
          .attr("height", 10)
          .style("fill", color(i));

        // Add text label
        legendItem.append("text")
          .attr("x", 20)  // Position text to the right of the box
          .attr("y", 10)
          .text(s.name)
          .style("alignment-baseline", "middle");
      });
    });
    // <div id="tooltip" style="position: absolute; background-color: white; padding: 5px; border: 1px solid #ddd; border-radius: 3px; display: none;"></div>

  </script>
  
</body>
</html>
